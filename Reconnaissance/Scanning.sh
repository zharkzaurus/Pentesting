#!/bin/bash
echo "Running script..."
#Checks if nmap is installed if not it installs it
if ! command -v nmap &> /dev/null
then
        echo "nmap not found installing..."
        apt-get update
        apt-get install nmap -y
        exit 1
fi

# Check if a target is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <target>"
    exit 1
fi
echo "Scaning Ip address"
#scans ports to see if they are open
ports=$(nmap -p- --min-rate=1000 $1 | grep '^[0-9]' | cut -d '/' -f 1 | tr '\n' ',' | sed 's/,$//')
# Check if any ports were found
if [ -n "$ports" ]; then
        # Perform a detailed scan on the found port
        nmap -p$ports -sC -sV --script vulners $1 -oN nmap-$1.log
else
        echo "No ports found."
fi
#Check if file is installed
file=logs
if [ -f "$file" ]; then
        mv nmap-$1.log logs/
else
        mkdir $file
        mv nmap-$1.log logs/
fi
echo "Information saved on file logs/nmap-$1.log"
